<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/apiHandler - Goonstation 13</title></head><body><header><a href="index.html">Goonstation 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/apiHandler.html#var">Var Details</a> - <a href="datum/apiHandler.html#proc">Proc Details</a></header><main><h1>/<a href="datum.html">datum</a>/<a href="datum/apiHandler.html">apiHandler</a> <img src="git.png" width="16" height="16" title="code/modules/goonhub/api/api.dm 8"></h1><p>Handles queries to the Goonhub APIv2</p><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/apiHandler.html#var/apiRetryDelay">apiRetryDelay</a></th><td>base delay between query attempts, gets multiplied by attempt number</td></tr><tr><th><a href="datum/apiHandler.html#var/debug">debug</a></th><td>Is debug logging on? If true, detailed logs for each API request will be logged to debug</td></tr><tr><th><a href="datum/apiHandler.html#var/emergency_shutoff_counter">emergency_shutoff_counter</a></th><td>how many api errors there have been since a successful one</td></tr><tr><th><a href="datum/apiHandler.html#var/enabled">enabled</a></th><td>Is the api handler available for use? only set to false if we try a bunch of times and still fail</td></tr><tr><th><a href="datum/apiHandler.html#var/lazy_concurrent_counter">lazy_concurrent_counter</a></th><td>lazy count of how many are up/down</td></tr><tr><th><a href="datum/apiHandler.html#var/lazy_waiting_counter">lazy_waiting_counter</a></th><td>number of how many are waiting</td></tr><tr><th><a href="datum/apiHandler.html#var/maxApiRetries">maxApiRetries</a></th><td>how many times should a query attempt to run before giving up</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/apiHandler.html#proc/apiError">apiError</a></th><td>Build and throw an error exception</td></tr><tr><th><a href="datum/apiHandler.html#proc/debugLogRequest">debugLogRequest</a></th><td>Log an API request</td></tr><tr><th><a href="datum/apiHandler.html#proc/debugLogResponse">debugLogResponse</a></th><td>Log an API response</td></tr><tr><th><a href="datum/apiHandler.html#proc/queryAPI">queryAPI</a></th><td>Constructs a query to send to the goonhub web API</td></tr><tr><th><a href="datum/apiHandler.html#proc/retryApiQuery">retryApiQuery</a></th><td>Retries an API query in the event of failure</td></tr><tr><th><a href="datum/apiHandler.html#proc/trackRecentError">trackRecentError</a></th><td>Increments or resets the recent error counter</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/apiRetryDelay"><aside class="declaration">var </aside>apiRetryDelay <img src="git.png" width="16" height="16" title="code/modules/goonhub/api/api.dm 17"></h3><p>base delay between query attempts, gets multiplied by attempt number</p><h3 id="var/debug"><aside class="declaration">var </aside>debug <img src="git.png" width="16" height="16" title="code/modules/goonhub/api/api.dm 12"></h3><p>Is debug logging on? If true, detailed logs for each API request will be logged to debug</p><h3 id="var/emergency_shutoff_counter"><aside class="declaration">var </aside>emergency_shutoff_counter <img src="git.png" width="16" height="16" title="code/modules/goonhub/api/api.dm 20"></h3><p>how many api errors there have been since a successful one</p><h3 id="var/enabled"><aside class="declaration">var </aside>enabled <img src="git.png" width="16" height="16" title="code/modules/goonhub/api/api.dm 10"></h3><p>Is the api handler available for use? only set to false if we try a bunch of times and still fail</p><h3 id="var/lazy_concurrent_counter"><aside class="declaration">var </aside>lazy_concurrent_counter <img src="git.png" width="16" height="16" title="code/modules/goonhub/api/api.dm 22"></h3><p>lazy count of how many are up/down</p><h3 id="var/lazy_waiting_counter"><aside class="declaration">var </aside>lazy_waiting_counter <img src="git.png" width="16" height="16" title="code/modules/goonhub/api/api.dm 24"></h3><p>number of how many are waiting</p><h3 id="var/maxApiRetries"><aside class="declaration">var </aside>maxApiRetries <img src="git.png" width="16" height="16" title="code/modules/goonhub/api/api.dm 15"></h3><p>how many times should a query attempt to run before giving up</p><h2 id="proc">Proc Details</h2><h3 id="proc/apiError"><aside class="declaration">proc </aside>apiError<aside>(/list/data, source)  <img src="git.png" width="16" height="16" title="code/modules/goonhub/api/api.dm 38"></aside></h3><p>Build and throw an error exception</p><h3 id="proc/debugLogRequest"><aside class="declaration">proc </aside>debugLogRequest<aside>(method, route, body)  <img src="git.png" width="16" height="16" title="code/modules/goonhub/api/api.dm 65"></aside></h3><p>Log an API request</p>
<p>@method (string) HTTP method of the request
@route (string) URL of the request
@body (string) JSON encoded body of the request if applicable</p><h3 id="proc/debugLogResponse"><aside class="declaration">proc </aside>debugLogResponse<aside>(method, route, body, headers, status)  <img src="git.png" width="16" height="16" title="code/modules/goonhub/api/api.dm 79"></aside></h3><p>Log an API response</p>
<p>@method (string) HTTP method of the request
@route (string) URL of the request
@body (string) JSON encoded body of the response
@headers (list) Response headers
@status (int) Response status code</p><h3 id="proc/queryAPI"><aside class="declaration">proc </aside>queryAPI<aside>(/<a href="datum.html">datum</a>/<a href="datum/apiRoute.html">apiRoute</a>/route, attempt)  <img src="git.png" width="16" height="16" title="code/modules/goonhub/api/api.dm 117"></aside></h3><p>Constructs a query to send to the goonhub web API</p>
<p>@route (/datum/apiRoute) requested route to call, ex. /datum/apiRoute/players/notes/get
@attempt (int) number of times we've attempted this query
@return (/datum/apiModel|boolean) model containing parsed data response from api, or boolean indicating success</p><h3 id="proc/retryApiQuery"><aside class="declaration">proc </aside>retryApiQuery<aside>(/<a href="datum.html">datum</a>/<a href="datum/apiRoute.html">apiRoute</a>/route, attempt)  <img src="git.png" width="16" height="16" title="code/modules/goonhub/api/api.dm 51"></aside></h3><p>Retries an API query in the event of failure</p>
<p>@route (/datum/apiRoute) requested route to call, ex. /datum/apiRoute/players/notes/get
@attempt (int) number of times we've attempted this query
@return (/datum/apiModel) model containing parsed data response from api</p><h3 id="proc/trackRecentError"><aside class="declaration">proc </aside>trackRecentError<aside>(reset)  <img src="git.png" width="16" height="16" title="code/modules/goonhub/api/api.dm 91"></aside></h3><p>Increments or resets the recent error counter</p>
<p>@reset (bool) reset the counter (eg successful request)</p></main><footer>goonstation.dme e18c4efa8a3ab2e13df0a169b767dbc7355e7294 — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.10.0</a></footer></body></html>